<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="/css/weui.css"/>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=5F1YoiVMkVZxB0PkegE8vb60Hl0rPIzc"></script>
    <title>失物列表</title>
</head>
<body>
<div id="wrap">
    <div id="mainbody"></div>
</div>

<script type="text/template" id="tpl-mainbody">

<div class="weui-search-bar" id="searchBar">
    <form class="weui-search-bar__form">
        <div class="weui-search-bar__box">
            <i class="weui-icon-search"></i>
            <input class="weui-search-bar__input" type="text" id="searchInput" placeholder="搜索" required />
            <a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
        </div>
        <label class="weui-search-bar__label" id="searchText">
            <i class="weui-icon-search"></i>
            <span>搜索</span>
        </label>
    </form>
    <!--
    <a onclick="m_searchByPlace()"><img src="location.png" style="padding-left: 0.4em; vertical-align:middle; width:1em "></a>
    -->
    <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
    <a href="javascript:" class="weui-search-bar_focusing" id="createLost"><img src="/img/new.png" style="padding-left: 0.3em; vertical-align:middle; width:1em "></a>
</div>


{% if locals.items %}
<div class="weui-panel__bd">
    <!-- item -->
    {% for item in items %}


        <div class="weui-media-box weui-media-box_appmsg item" id="item-{{ item.id }}">
            <div class="weui-media-box__hd">
                <img class="weui-media-box__thumb" src="{{ item.picUrl }}" alt>
            </div>
            <div class="weui-media-box__bd">
                <h4 class="weui-media-box__title">{{ item.name }}</h4>
                <p class="weui-media-box__desc">{{ item.description }}</p>
                <ul class="weui-media-box__info">
                    <li class="weui-media-box__info__meta"><img src="/img/location.png">{{ item.lostPlace }} </li>
                    {% if item.showtime %}
                    <div class="date" style="float:right; width:38%">
                        <li class="weui-media-box__info__meta">{{ item.showtime }}</li>
                    </div>
                    {% endif %}
                </ul>
            </div>
        </div>

    {% endfor %}
</div>
{% else %}
没有拾物
{% endif %}
</script>


<script src="/3rd/jquery.js"></script>
<script src="/3rd/swig.js"></script>
<script src="/js/weixin_lib.js"></script>
<script src="/js/base.js"></script>

<script>
    var locals = {};
    var render = function () {
        $('#mainbody').html(swig.render($('#tpl-mainbody').html(), {locals: locals}));
        $('.item').click( function () {
            var strs = $(this).attr("id").split('-');
            if(strs.length == 2){
                window.location.href = "/u/found/detail?id="+strs[1];
        }
    });
        $('#searchText').on('click', function(){
            $('#searchBar').addClass('weui-search-bar_focusing');
            $('#searchInput').focus();
            $('#createLost').hide();
        });
        $('#searchInput').on('blur', function () {
                if(!this.value.length) cancelSearch();
            });
        $('#searchClear').on('click', function(){
            $('#searchInput').val('');
            $('#searchInput').focus();
        });
        $('#searchCancel').on('click', function(){
            cancelSearch();
            $('#searchInput').blur();
        });
        $('#createLost').on('click', function () {
            window.location.href = "/u/lost/new?user="+locals.user;
        });

        function cancelSearch(){
            $('#searchBar').removeClass('weui-search-bar_focusing');
            $('#searchText').show();
            $('#createLost').show();
        }
    };
    $(function () {
        swig.setDefaultTZOffset(new Date().getTimezoneOffset());
        locals.user = urlParam.user;
        api.get('/api/u/found/list', {}, function (data) {
            swig.setDefaultTZOffset(new Date().getTimezoneOffset());
            locals.items = data;
            for (i=0;i<data.length;i++) {
                updateDate(locals.items[i],'lostTime');
                if( locals.items[i].lostTime.yyyymmdd() != '1970-01-01')
                    locals.items[i].showtime = locals.items[i].lostTime.yyyymmdd();
            }
            render();

        }, dftFail);
    });

    var m_searchByPlace= function () {

    }

</script>
</body>
</html>